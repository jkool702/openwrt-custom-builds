#!/bin/sh

{ [ -f /etc/config/sqm ] && ! [ "$(cat /etc/config/sqm)" = "$(cat /rom/etc/config/sqm)" ]; } || {
uci batch <<'EOF'
delete sqm.wan
set sqm.wan=queue
set sqm.wan.enabled='0'
set sqm.wan.interface='wan'
set sqm.wan.qdisc='fq_codel'
set sqm.wan.script='nss-zk.qos'
set sqm.wan.overhead='44'
set sqm.wan.linklayer='ethernet'
set sqm.wan.linklayer_advanced='1'
set sqm.wan.tcMPU='84'
set sqm.wan.ingress_ecn='ECN'
set sqm.wan.egress_ecn='NOECN'
set sqm.wan.squash_dscp='0'
set sqm.wan.squash_ingress='0'
set sqm.wan.tcMTU='2047'
set sqm.wan.tcTSIZE='512'
EOF
uci commit sqm
}
exit 0
